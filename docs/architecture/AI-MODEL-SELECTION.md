# FlowSight AI æ¨¡åž‹ç­–ç•¥

> æ–‡æ¡£ç‰ˆæœ¬: 2.0
> æœ€åŽæ›´æ–°: 2026-01-08

---

## 1. ç­–ç•¥è°ƒæ•´

### 1.1 v1.0 ç‰ˆæœ¬ç­–ç•¥å˜æ›´

**åŽŸæ–¹æ¡ˆ**ï¼šæœ¬åœ°éƒ¨ç½² DeepSeek-Coder æ¨¡åž‹ï¼Œéœ€è¦è‡ªå·±è®­ç»ƒå’Œè’¸é¦

**æ–°æ–¹æ¡ˆ**ï¼šè°ƒç”¨å¤–éƒ¨ LLM APIï¼ŒçŸ¥è¯†åº“ + è§„åˆ™å¼•æ“Žå¤„ç† 80% åœºæ™¯ï¼ŒAI å¤„ç† 20% è¾¹ç•Œæƒ…å†µ

### 1.2 å˜æ›´ç†ç”±

| åŽŸæ–¹æ¡ˆé—®é¢˜ | æ–°æ–¹æ¡ˆä¼˜åŠ¿ |
|-----------|-----------|
| è®­ç»ƒæˆæœ¬é«˜ï¼ˆæ•°æ®æ ‡æ³¨ã€GPU èµ„æºï¼‰ | é›¶è®­ç»ƒæˆæœ¬ï¼Œç›´æŽ¥ä½¿ç”¨ |
| å¼€å‘å‘¨æœŸé•¿ï¼ˆ12+ å‘¨ï¼‰ | å¿«é€Ÿé›†æˆï¼ˆ2-3 å‘¨ï¼‰ |
| æ¨¡åž‹æ•ˆæžœä¸ç¡®å®š | ä½¿ç”¨æˆç†Ÿçš„é¡¶çº§æ¨¡åž‹ |
| æœ¬åœ°éƒ¨ç½²å¯¹ç”¨æˆ·ç¡¬ä»¶è¦æ±‚é«˜ | æ— ç¡¬ä»¶è¦æ±‚ |
| ç»´æŠ¤æˆæœ¬é«˜ï¼ˆæ¨¡åž‹æ›´æ–°ã€bug ä¿®å¤ï¼‰ | æ¨¡åž‹æŒç»­æ”¹è¿›ï¼Œæ— éœ€ç»´æŠ¤ |

---

## 2. v1.0 AI æž¶æž„

### 2.1 æ•´ä½“æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FlowSight v1.0 AI æž¶æž„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ä»£ç åˆ†æžè¯·æ±‚                                                            â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å±‚æ¬¡1ï¼šçŸ¥è¯†åº“åŒ¹é… (80% åœºæ™¯)                                    â”‚    â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                 â”‚    â”‚
â”‚  â”‚  â€¢ æ¡†æž¶æ¨¡å¼åŒ¹é… (USB driver, file_operations, etc.)             â”‚    â”‚
â”‚  â”‚  â€¢ å¼‚æ­¥æœºåˆ¶è¯†åˆ« (WorkQueue, Timer, IRQ)                         â”‚    â”‚
â”‚  â”‚  â€¢ ops è¡¨å‡½æ•°æŒ‡é’ˆè§£æž                                           â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  âœ… å‘½ä¸­ â†’ ç›´æŽ¥è¿”å›žç»“æžœ                                         â”‚    â”‚
â”‚  â”‚  âŒ æœªå‘½ä¸­ â†’ è¿›å…¥å±‚æ¬¡2                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼ (ä»… 20% è¾¹ç•Œæƒ…å†µ)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å±‚æ¬¡2ï¼šLLM API è°ƒç”¨                                             â”‚    â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                         â”‚    â”‚
â”‚  â”‚  â€¢ æå–ä»£ç ä¸Šä¸‹æ–‡                                                â”‚    â”‚
â”‚  â”‚  â€¢ æž„é€  Prompt                                                   â”‚    â”‚
â”‚  â”‚  â€¢ è°ƒç”¨å¤–éƒ¨ LLM API                                              â”‚    â”‚
â”‚  â”‚  â€¢ è§£æžå“åº”ï¼Œç¼“å­˜ç»“æžœ                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ç»“æžœç¼“å­˜                                                        â”‚    â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•                                                       â”‚    â”‚
â”‚  â”‚  â€¢ ç¼“å­˜ LLM å“åº”åˆ°æœ¬åœ°                                          â”‚    â”‚
â”‚  â”‚  â€¢ ä¸‹æ¬¡ç›¸åŒæŸ¥è¯¢ç›´æŽ¥è¿”å›ž                                          â”‚    â”‚
â”‚  â”‚  â€¢ ç”¨æˆ·å¯ç¡®è®¤/å¦å®šç»“æžœï¼Œåé¦ˆåˆ°çŸ¥è¯†åº“                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ”¯æŒçš„ LLM API

| æä¾›å•† | æ¨¡åž‹ | ä¼˜å…ˆçº§ | è¯´æ˜Ž |
|--------|------|--------|------|
| Anthropic | Claude 3.5 Sonnet / Claude 3 Opus | P0 | ä»£ç ç†è§£èƒ½åŠ›å¼º |
| OpenAI | GPT-4o / GPT-4 Turbo | P0 | ç”Ÿæ€æˆç†Ÿ |
| DeepSeek | DeepSeek-Coder | P1 | æ€§ä»·æ¯”é«˜ |
| æœ¬åœ° Ollama | Qwen2.5-Coder / DeepSeek-Coder | P2 | ç¦»çº¿ä½¿ç”¨ |

### 2.3 é…ç½®æ–¹å¼

```yaml
# ~/.flowsight/config.yaml
ai:
  # é»˜è®¤æä¾›å•†
  provider: anthropic  # anthropic | openai | deepseek | ollama

  # API é…ç½®
  anthropic:
    api_key: ${ANTHROPIC_API_KEY}  # ä»ŽçŽ¯å¢ƒå˜é‡è¯»å–
    model: claude-sonnet-4-20250514

  openai:
    api_key: ${OPENAI_API_KEY}
    model: gpt-4o
    base_url: https://api.openai.com/v1  # å¯è‡ªå®šä¹‰

  deepseek:
    api_key: ${DEEPSEEK_API_KEY}
    model: deepseek-coder

  ollama:
    base_url: http://localhost:11434
    model: qwen2.5-coder:7b

  # é€šç”¨é…ç½®
  cache_enabled: true
  cache_ttl: 7d  # ç¼“å­˜æœ‰æ•ˆæœŸ
  max_context_tokens: 8000  # æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦
```

---

## 3. AI ä½¿ç”¨åœºæ™¯

### 3.1 å‡½æ•°æŒ‡é’ˆç›®æ ‡é¢„æµ‹

å½“çŸ¥è¯†åº“æ— æ³•ç¡®å®šå‡½æ•°æŒ‡é’ˆæŒ‡å‘æ—¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœºæ™¯ï¼šæ— æ³•è§£æžçš„å‡½æ•°æŒ‡é’ˆ                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ä»£ç ï¼š                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ void (*callback)(void *data);                                    â”‚    â”‚
â”‚  â”‚ callback = get_handler(type);  // åŠ¨æ€èŽ·å–                       â”‚    â”‚
â”‚  â”‚ callback(ctx);                 // è°ƒç”¨ â†’ æŒ‡å‘è°ï¼Ÿ                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  Prompt æž„é€ ï¼š                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ åˆ†æžä»¥ä¸‹ Linux å†…æ ¸ä»£ç ä¸­çš„å‡½æ•°æŒ‡é’ˆè°ƒç”¨ã€‚                        â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚ ä¸Šä¸‹æ–‡ä»£ç ï¼š                                                     â”‚    â”‚
â”‚  â”‚ [åŒ…å« get_handler å‡½æ•°å®šä¹‰å’Œç›¸å…³ä»£ç ]                           â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚ é—®é¢˜ï¼šcallback(ctx) åœ¨è¿è¡Œæ—¶æœ€å¯èƒ½è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Ÿ                â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚ è¯·è¿”å›ž JSON æ ¼å¼ï¼š                                               â”‚    â”‚
â”‚  â”‚ {"targets": ["func1", "func2"], "confidence": 0.8}              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  LLM å“åº”ï¼š                                                              â”‚
â”‚  {"targets": ["handle_type_a", "handle_type_b"], "confidence": 0.85}   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¼‚æ­¥è§¦å‘æ—¶æœºè§£é‡Š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœºæ™¯ï¼šè§£é‡Š callback ä½•æ—¶è¢«è°ƒç”¨                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  ä»£ç ï¼š                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ static int my_notifier(struct notifier_block *nb, ...)          â”‚    â”‚
â”‚  â”‚ {                                                                â”‚    â”‚
â”‚  â”‚     // è¿™ä¸ªå‡½æ•°ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Ÿ                                  â”‚    â”‚
â”‚  â”‚ }                                                                â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚ register_netdevice_notifier(&my_nb);                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  LLM å“åº”ï¼š                                                              â”‚
â”‚  "my_notifier ä¼šåœ¨ä»¥ä¸‹æƒ…å†µè¢«è°ƒç”¨ï¼š                                      â”‚
â”‚   1. ç½‘ç»œè®¾å¤‡æ³¨å†Œæ—¶ (NETDEV_REGISTER)                                   â”‚
â”‚   2. ç½‘ç»œè®¾å¤‡å¯åŠ¨æ—¶ (NETDEV_UP)                                         â”‚
â”‚   3. ç½‘ç»œè®¾å¤‡å…³é—­æ—¶ (NETDEV_DOWN)                                       â”‚
â”‚   4. ç½‘ç»œè®¾å¤‡æ³¨é”€æ—¶ (NETDEV_UNREGISTER)                                 â”‚
â”‚   è°ƒç”¨ä¸Šä¸‹æ–‡ï¼šè¿›ç¨‹ä¸Šä¸‹æ–‡ï¼ŒæŒæœ‰ rtnl_lock"                               â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ä»£ç é—®ç­”

ç”¨æˆ·å¯ä»¥ç›´æŽ¥è¯¢é—®ä»£ç ç›¸å…³é—®é¢˜ï¼š

```
ç”¨æˆ·ï¼šè¿™ä¸ªé©±åŠ¨çš„ probe å‡½æ•°åšäº†ä»€ä¹ˆï¼Ÿ

FlowSightï¼š
1. ä»ŽçŸ¥è¯†åº“èŽ·å– probe å‡½æ•°çš„æ‰§è¡Œæµ
2. æå–å…³é”®ä»£ç ç‰‡æ®µ
3. è°ƒç”¨ LLM ç”Ÿæˆè‡ªç„¶è¯­è¨€è§£é‡Š
4. è¿”å›žç»“æž„åŒ–ç­”æ¡ˆ
```

---

## 4. å®žçŽ°ç»†èŠ‚

### 4.1 Rust åŽç«¯å®žçŽ°

```rust
// flowsight-ai/src/lib.rs

use async_trait::async_trait;
use serde::{Deserialize, Serialize};

#[async_trait]
pub trait LlmProvider: Send + Sync {
    async fn complete(&self, prompt: &str) -> Result<String, Error>;
    fn name(&self) -> &str;
}

pub struct AnthropicProvider {
    client: reqwest::Client,
    api_key: String,
    model: String,
}

#[async_trait]
impl LlmProvider for AnthropicProvider {
    async fn complete(&self, prompt: &str) -> Result<String, Error> {
        let response = self.client
            .post("https://api.anthropic.com/v1/messages")
            .header("x-api-key", &self.api_key)
            .header("anthropic-version", "2023-06-01")
            .json(&serde_json::json!({
                "model": self.model,
                "max_tokens": 4096,
                "messages": [{"role": "user", "content": prompt}]
            }))
            .send()
            .await?;

        // è§£æžå“åº”...
        Ok(content)
    }

    fn name(&self) -> &str {
        "anthropic"
    }
}

// ç±»ä¼¼å®žçŽ° OpenAIProvider, DeepSeekProvider, OllamaProvider
```

### 4.2 ç¼“å­˜æœºåˆ¶

```rust
// flowsight-ai/src/cache.rs

use std::collections::HashMap;
use std::time::{Duration, Instant};

pub struct AiCache {
    entries: HashMap<String, CacheEntry>,
    ttl: Duration,
}

struct CacheEntry {
    response: String,
    created_at: Instant,
    confirmed: Option<bool>,  // ç”¨æˆ·ç¡®è®¤/å¦å®š
}

impl AiCache {
    pub fn get(&self, prompt_hash: &str) -> Option<&str> {
        self.entries.get(prompt_hash)
            .filter(|e| e.created_at.elapsed() < self.ttl)
            .map(|e| e.response.as_str())
    }

    pub fn set(&mut self, prompt_hash: String, response: String) {
        self.entries.insert(prompt_hash, CacheEntry {
            response,
            created_at: Instant::now(),
            confirmed: None,
        });
    }

    pub fn confirm(&mut self, prompt_hash: &str, is_correct: bool) {
        if let Some(entry) = self.entries.get_mut(prompt_hash) {
            entry.confirmed = Some(is_correct);
        }
    }
}
```

### 4.3 Prompt æ¨¡æ¿

```rust
// flowsight-ai/src/prompts.rs

pub const FUNCTION_POINTER_PROMPT: &str = r#"
ä½ æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä»£ç åˆ†æžä¸“å®¶ã€‚åˆ†æžä»¥ä¸‹ä»£ç ä¸­çš„å‡½æ•°æŒ‡é’ˆè°ƒç”¨ã€‚

## ä»£ç ä¸Šä¸‹æ–‡
```c
{context}
```

## é—®é¢˜
åœ¨ç¬¬ {line} è¡Œï¼Œ`{expression}` è¿™ä¸ªå‡½æ•°æŒ‡é’ˆè°ƒç”¨åœ¨è¿è¡Œæ—¶æœ€å¯èƒ½æŒ‡å‘å“ªäº›å‡½æ•°ï¼Ÿ

## è¦æ±‚
1. åŸºäºŽä»£ç ä¸Šä¸‹æ–‡æŽ¨æ–­å¯èƒ½çš„ç›®æ ‡å‡½æ•°
2. è€ƒè™‘ç±»åž‹åŒ¹é…ã€èµ‹å€¼è·¯å¾„ã€å¸¸è§æ¨¡å¼
3. è¿”å›ž JSON æ ¼å¼

## å“åº”æ ¼å¼
```json
{
  "targets": ["å‡½æ•°å1", "å‡½æ•°å2"],
  "confidence": 0.0-1.0,
  "reasoning": "æŽ¨ç†è¿‡ç¨‹ç®€è¿°"
}
```
"#;

pub const CALLBACK_TIMING_PROMPT: &str = r#"
ä½ æ˜¯ä¸€ä¸ª Linux å†…æ ¸ä»£ç åˆ†æžä¸“å®¶ã€‚è§£é‡Šä»¥ä¸‹å›žè°ƒå‡½æ•°çš„è§¦å‘æ—¶æœºã€‚

## ä»£ç 
```c
{code}
```

## é—®é¢˜
å‡½æ•° `{function_name}` ä»€ä¹ˆæ—¶å€™ä¼šè¢«å†…æ ¸è°ƒç”¨ï¼Ÿ

## è¦æ±‚
1. è¯´æ˜Žè§¦å‘æ¡ä»¶
2. è¯´æ˜Žè°ƒç”¨ä¸Šä¸‹æ–‡ï¼ˆè¿›ç¨‹/ä¸­æ–­/è½¯ä¸­æ–­ï¼‰
3. è¯´æ˜Žæ˜¯å¦å¯ä»¥ç¡çœ 
4. åˆ—å‡ºå¯èƒ½æŒæœ‰çš„é”

## å“åº”æ ¼å¼
ç®€æ´çš„ä¸­æ–‡è¯´æ˜Žï¼Œä¸è¶…è¿‡ 200 å­—ã€‚
"#;
```

---

## 5. ç”¨æˆ·ä½“éªŒ

### 5.1 é¦–æ¬¡ä½¿ç”¨é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é…ç½® AI åŠŸèƒ½                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  FlowSight ä½¿ç”¨ AI æ¥å¢žå¼ºä»£ç åˆ†æžèƒ½åŠ›ã€‚è¯·é€‰æ‹© AI æä¾›å•†ï¼š               â”‚
â”‚                                                                          â”‚
â”‚  â—‹ Anthropic Claude (æŽ¨è)                                              â”‚
â”‚    API Key: [________________________]                                   â”‚
â”‚                                                                          â”‚
â”‚  â—‹ OpenAI GPT-4                                                         â”‚
â”‚    API Key: [________________________]                                   â”‚
â”‚                                                                          â”‚
â”‚  â—‹ DeepSeek                                                             â”‚
â”‚    API Key: [________________________]                                   â”‚
â”‚                                                                          â”‚
â”‚  â—‹ æœ¬åœ° Ollama (ç¦»çº¿ä½¿ç”¨)                                               â”‚
â”‚    éœ€è¦å…ˆå®‰è£… Ollama å¹¶ä¸‹è½½æ¨¡åž‹                                         â”‚
â”‚                                                                          â”‚
â”‚  â—‹ æš‚ä¸é…ç½® (ä»…ä½¿ç”¨çŸ¥è¯†åº“)                                              â”‚
â”‚                                                                          â”‚
â”‚  [ ] å…è®¸å‘é€ä»£ç ç‰‡æ®µåˆ° AI æœåŠ¡                                         â”‚
â”‚                                                                          â”‚
â”‚                              [è·³è¿‡]  [ä¿å­˜]                              â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 AI ç»“æžœæ ‡æ³¨

åœ¨æ‰§è¡Œæµå›¾ä¸­ï¼ŒAI æŽ¨æ–­çš„ç»“æžœä¼šæœ‰ç‰¹æ®Šæ ‡æ³¨ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ‰§è¡Œæµè§†å›¾                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ my_handler  â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ callback()  â”‚ ðŸ¤– AI æŽ¨æ–­ (85%)                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚         â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ process_    â”‚ â† AI æŽ¨æ–­çš„ç›®æ ‡                                        â”‚
â”‚  â”‚ data        â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                          â”‚
â”‚  [âœ“ ç¡®è®¤] [âœ— å¦å®š] [? æŸ¥çœ‹æŽ¨ç†]                                         â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ç”¨æˆ·åé¦ˆå¾ªçŽ¯

ç”¨æˆ·å¯ä»¥ç¡®è®¤æˆ–å¦å®š AI çš„æŽ¨æ–­ï¼š
- ç¡®è®¤ï¼šç»“æžœè¢«æ°¸ä¹…ç¼“å­˜ï¼Œæå‡åŽç»­å‡†ç¡®çŽ‡
- å¦å®šï¼šæç¤ºç”¨æˆ·è¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼Œæ›´æ–°çŸ¥è¯†åº“

---

## 6. æˆæœ¬ä¼°ç®—

### 6.1 API è°ƒç”¨æˆæœ¬

| åœºæ™¯ | é¢„ä¼°è°ƒç”¨æ¬¡æ•°/å¤© | Token æ¶ˆè€— | æœˆæˆæœ¬ (Claude) |
|------|----------------|-----------|-----------------|
| è½»åº¦ä½¿ç”¨ | 10-20 æ¬¡ | ~50K | ~$1.5 |
| ä¸­åº¦ä½¿ç”¨ | 50-100 æ¬¡ | ~250K | ~$7.5 |
| é‡åº¦ä½¿ç”¨ | 200+ æ¬¡ | ~1M | ~$30 |

### 6.2 æˆæœ¬ä¼˜åŒ–ç­–ç•¥

1. **çŸ¥è¯†åº“ä¼˜å…ˆ**ï¼š80% åœºæ™¯ä¸è°ƒç”¨ API
2. **ç»“æžœç¼“å­˜**ï¼šç›¸åŒæŸ¥è¯¢ä¸é‡å¤è°ƒç”¨
3. **ä¸Šä¸‹æ–‡è£å‰ª**ï¼šåªå‘é€å¿…è¦çš„ä»£ç ç‰‡æ®µ
4. **æ‰¹é‡å¤„ç†**ï¼šåˆå¹¶å¤šä¸ªå°æŸ¥è¯¢

---

## 7. éšç§ä¸Žå®‰å…¨

### 7.1 æ•°æ®å¤„ç†åŽŸåˆ™

- ä»£ç ç‰‡æ®µä»…åœ¨ç”¨æˆ·æ˜Žç¡®åŒæ„åŽå‘é€
- ä¸å‘é€å®Œæ•´æ–‡ä»¶ï¼Œåªå‘é€å¿…è¦ä¸Šä¸‹æ–‡
- æ”¯æŒæœ¬åœ° Ollama ä½œä¸ºå®Œå…¨ç¦»çº¿é€‰é¡¹
- API Key åŠ å¯†å­˜å‚¨åœ¨æœ¬åœ°

### 7.2 æ•æ„Ÿä»£ç å¤„ç†

```yaml
# .flowsight/config.yaml
ai:
  # æ•æ„Ÿæ–‡ä»¶ä¸å‘é€åˆ° AI
  exclude_patterns:
    - "**/credentials/**"
    - "**/*.key"
    - "**/secrets/**"
```

---

## 8. å®žæ–½è®¡åˆ’

### v1.0 (å¿…é¡»)
- [ ] Anthropic Claude API é›†æˆ
- [ ] OpenAI API é›†æˆ
- [ ] åŸºæœ¬ç¼“å­˜æœºåˆ¶
- [ ] å‡½æ•°æŒ‡é’ˆé¢„æµ‹ Prompt
- [ ] UI é…ç½®ç•Œé¢

### v1.x (å¢žå¼º)
- [ ] DeepSeek API é›†æˆ
- [ ] Ollama æœ¬åœ°æ¨¡åž‹æ”¯æŒ
- [ ] ç”¨æˆ·åé¦ˆå¾ªçŽ¯
- [ ] ä»£ç é—®ç­”åŠŸèƒ½
- [ ] æ‰¹é‡åˆ†æžä¼˜åŒ–

---

## é™„å½•ï¼šAPI å‚è€ƒ

- [Anthropic API æ–‡æ¡£](https://docs.anthropic.com/claude/reference)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs/api-reference)
- [DeepSeek API æ–‡æ¡£](https://platform.deepseek.com/docs)
- [Ollama æ–‡æ¡£](https://ollama.ai/docs)
